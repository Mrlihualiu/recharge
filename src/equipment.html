<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8" />
	<title>设备调试</title>
	<link rel="stylesheet" type="text/css" href="layui/css/layui.css" />
	<style type="text/css">
		.layui-form-label {
			width: 100px;
			padding: 9px 5px;
		}
	</style>
</head>

<body class="layui-layout-body">
	<div class="layui-layout layui-layout-admin">
		<div class="layui-header" style="background: #eee;">
			<div class="layui-logo"><img src="img/equipment.png" style="width: 25px;" />&nbsp;设备调试</div>
		</div>
		<div class="layui-body" style="left: 0;padding: 20px;">
			<div id="demoTable">
				<button id="xinzeng" type="button" class="layui-btn">开始调试</button>
			</div>
			<table class="layui-hide" id="test3" lay-filter="test3">

			</table>
		</div>
	</div>
	<div class="layui-progress" lay-showPercent="yes">
		<div class="layui-progress-bar layui-bg-red" lay-percent="30%"></div>
	</div>
</body>
<script src="js/jquery-2.1.1.min.js" type="text/javascript" charset="utf-8"></script>
<script src="layui/layui.js" type="text/javascript" charset="utf-8"></script>
<script>
	function getsj() {
		var equData = localStorage.getItem("sbxxData");
		if (equData != undefined && equData != null && equData != "") {
			equData = JSON.parse(equData);
			var tj = $("#tj").val();
			if (tj != null && tj != "") {
				equData = equData.filter(function (obj) {
					return obj.xh == tj;
				})
			}
			return equData;
		} else {
			return [];
		}
	}
	var sjTable;
	layui.use('table', function () {
		var table = layui.table,
			laypage = layui.laypage;
		//不显示首页尾页
		laypage.render({
			elem: 'demo4',
			count: 100,
			first: false,
			last: false
		});
		sjTable = table.render({
			elem: '#test3',
			data: getsj(),
			title: '设备调试',
			page: { //支持传入 laypage 组件的所有参数（某些参数除外，如：jump/elem） - 详见文档
				layout: ['count', 'prev', 'page', 'next', 'skip'] //自定义分页布局

			},
			height: 480,
			cols: [
				[{
					type: 'checkbox'
				}, {
					field: 'xh',
					title: '仪器编号',
					sort: true,
					edit: 'text'
				}, {
					field: 'mc',
					title: '型号规格',
					edit: 'text'
				}, {
					field: 'cj',
					title: '数量',
					edit: 'text'
				}, {
					field: 'gg',
					title: '颜色',
					edit: 'text'
				}, {
					field: 'cz',
					title: '材质',
					edit: 'text'
				}]
			]
		});

		//监听单元格编辑
		table.on('edit(test3)', function (obj) {
			var value = obj.value //得到修改后的值
				,
				data = obj.data //得到所在行所有键值
				,
				field = obj.field; //得到字段
		});
		var choosedData = null
		table.on('checkbox(test3)', function(data) {
			if (data.checked) {
				choosedData = data.data;
			} else {
				choosedData = null;
			}
		})

		var $ = layui.$,
			active = {
				reload: function () {
					//执行重载
					table.reload('test3', {
						page: {
							curr: 1 //重新从第 1 页开始
						},
						data: getsj()
					}, 'data');
				},
				delCheckData: function () { //获取选中数据
					var checkStatus = table.checkStatus('test3'),
						data = checkStatus.data;
					var equData = localStorage.getItem("equData");
					equData = JSON.parse(equData);

					equData = equData.filter(function (obj) {
						return !(obj.id == data[0].id);
					})
					localStorage.setItem("equData", JSON.stringify(equData));
					active["reload"]();
					layer.alert('删除成功');
				}
			};

		$("#xinzeng").click(function () {
			console.log(choosedData);
			if (choosedData == null) {
				layer.alert('请选择要调试的设备');
				return;
			}
			$("input[name='xh']").val(choosedData.xh);
			$("input[name='mc']").val(choosedData.mc);
			$("input[name='cj']").val(choosedData.cj);
			$("input[name='gg']").val(choosedData.gg);
			$("input[name='cz']").val(choosedData.cz);
			layer.open({
				type: 1,
				title: "<img src='img/add.png' style='width: 25px;' />&nbsp;设备验收",
				area: ['500px', '450px'],
				content: $('#xznr'), //这里content是一个DOM，注意：最好该元素要存放在body最外层，否则可能被其它的相对元素所影响
				btn: ['确定', '关闭'],
				yes: function (index, layero) {
					if ($("input[name='zl']").val()=='') {
						layer.alert('请输入调试端口号');
						return;
					}
					//按钮【按钮一】的回调
					var xh = $("input[name='xh']").val();
					var mc = $("input[name='mc']").val();
					var cj = $("input[name='cj']").val();
					var gg = $("input[name='gg']").val();
					var cz = $("input[name='cz']").val();
					var zl = $("input[name='zl']").val();
					var id = "" + Math.ceil(Math.random() * 10000000);

					$("input[name='xh']").val(choosedData.xh);
					$("input[name='mc']").val(choosedData.mc);
					$("input[name='cj']").val(choosedData.cj);
					$("input[name='gg']").val(choosedData.gg);
					$("input[name='cz']").val(choosedData.cz);
					$("input[name='intruduce']").val('');
					layer.close(index);
					layer.msg('编号'+choosedData.xh+'设备调试中~~~', {
						icon: 16,
						shade: 0.01,
						time: 8000
					});
				},
				btn2: function (index, layero) {
					//按钮【按钮二】的回调
					
					//return false 开启该代码可禁止点击该按钮关闭
				},
				cancel: function () {
					//右上角关闭回调

					//return false 开启该代码可禁止点击该按钮关闭
				}
			});
		})

	});
</script>
<script type="text/html" id="zizeng">
	{{d.LAY_TABLE_INDEX+1}}
</script>
<div id="xznr" class="layui-form" style="padding: 10px;display: none;">

	<div class="layui-form-item">
		<label class="layui-form-label">仪器编号：</label>
		<div class="layui-input-block">
			<input type="text" name="xh" lay-verify="title" autocomplete="off" placeholder="编号" class="layui-input">
		</div>
	</div>
	<div class="layui-form-item">
		<label class="layui-form-label">型号规格：</label>
		<div class="layui-input-block">
			<input type="text" name="mc" lay-verify="title" autocomplete="off" placeholder="型号规格" class="layui-input">
		</div>
	</div>
	<div class="layui-form-item">
		<label class="layui-form-label">数量：</label>
		<div class="layui-input-block">
			<input type="text" name="cj" lay-verify="title" autocomplete="off" placeholder="数量" class="layui-input">
		</div>
	</div>
	<div class="layui-form-item">
		<label class="layui-form-label">颜色：</label>
		<div class="layui-input-block">
			<input type="text" name="gg" lay-verify="title" autocomplete="off" class="layui-input">
		</div>
	</div>
	<div class="layui-form-item">
		<label class="layui-form-label">调试模式：</label>
		<div class="layui-input-block">
			<select name="cz" id="">
				<option value="0">平缓模式</option>
				<option value="1">加速模式</option>
			</select>
		</div>
	</div>
	<div class="layui-form-item">
		<label class="layui-form-label">端口：</label>
		<div class="layui-input-block">
			<input type="text" name="zl" lay-verify="title" autocomplete="off" placeholder="调试端口号" class="layui-input">
		</div>
	</div>
</div>

</html>